variant: fcos
version: 1.5.0
passwd:
  users:
    - name: core
      groups:
        - docker
      ssh_authorized_keys:
        - "${SSH_AUTHORIZED_KEY}"
storage:
  files:
    - path: /etc/sysconfig/docker
      overwrite: true
      contents:
        inline: |
          # Modify these options if you want to change the way the docker daemon runs
          OPTIONS="--tls=false -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"
    - path: /etc/otel-collector/otel-collector.yaml
      overwrite: true
      contents:
        inline: |
          receivers:
            docker_stats:
              collection_interval: 10s
              endpoint: unix:///var/run/docker.sock
              metrics:

                container.blockio.io_service_bytes_recursive:
                  enabled: false
                container.cpu.usage.kernelmode:
                  enabled: false
                container.cpu.usage.total:
                  enabled: false
                container.cpu.usage.usermode:
                  enabled: false
                container.cpu.utilization:
                  enabled: true
                container.memory.file:
                  enabled: true
                container.memory.percent:
                  enabled: true
                container.memory.total_cache:
                  enabled: false
                container.memory.usage.limit:
                  enabled: false
                container.memory.usage.total:
                  enabled: true
                container.network.io.usage.rx_bytes:
                  enabled: true
                container.network.io.usage.tx_bytes:
                  enabled: true

                container.uptime:
                  enabled: true

              hostmetrics:
                collection_interval: 10s
                scrapers:
                  cpu:
                  memory:
                  load:
                    cpu_average: true
          processors:
            resourcedetection:
              detectors: [gcp]
            batch:
          exporters:
            googlecloud:
            prometheusremotewrite:
              endpoint: ${PROM_ENDPOINT}
          service:
            pipelines:
              metrics:
                receivers: ${OTEL_METRICS_RECEIVERS}
                processors: [resourcedetection, batch]
                exporters: ${OTEL_METRICS_EXPORTERS}
